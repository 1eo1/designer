<!--
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../core-asset/core-asset.html">
<link rel="import" href="../designer-stage/designer-stage.html">
<link rel="import" href="../../src/commands/commands.html">

<dom-module id="designer-playground">

  <style>
    designer-playground {
      display: flex;
      box-sizing: border-box;
    }
    designer-playground > #main {
      display: flex;
      flex-direction: column;
      flex: 1;
    }
    designer-playground > nav {
      flex: 0 0 240px;
      z-index: 100;
    }
    designer-playground > nav > a {
      display: block;
      color: black;
      text-decoration: none;
      padding: 8px;
    }
    designer-playground > nav > a:hover {
      text-decoration: underline;
      cursor: hand;
    }
    designer-playground > #main > designer-stage {
      flex: 1;
    }
    designer-playground > #main > #html {
      flex: 0 0 400px;
      border: solid 1px #888;
      margin: 0;
      overflow: auto;
    }
  </style>

  <core-asset id="demo-doc-1" href="demo-doc-1.html"></core-asset>
  <core-asset id="demo-doc-2" href="demo-doc-2.html"></core-asset>

  <template>
    <nav on-click="_navOnClick">
      <a data-demo="demo-doc-1">Demo 1</a>
      <a data-demo="demo-doc-2">Demo 2</a>
    </nav>
    <div id="main">
      <designer-stage id="stage"></designer-stage>
      <pre id="html"></pre>
    </div>
  </template>

</dom-module>

<script>

  (function(global) {
    using(['DomCommandApplier'], function(DomCommandApplier) {

      global.DesignerPlayground = Polymer({
        is: 'designer-playground',

        created: function() {
          this.document = null;
          this.domCommandApplier = null;
        },

        ready: function() {
          this.$.stage.addEventListener('designer-command', (function(e) {
            var command = e.detail;
            this.domCommandApplier.apply(command);
            console.log('command', command, this.document);
            this.$.html.textContent = this.document.documentElement.outerHTML;
          }).bind(this));
        },

        _navOnClick: function(e) {
          if (e.target.tagName == 'A') {
            var module = document.createElement('dom-module');
            var demoName = e.target.dataset.demo;
            var demoAsset = module.import('designer-playground', '#' + demoName);

            demoAsset.load()
              .then(this.$.stage.setDocument.bind(this.$.stage))
              .then((function(doc) {
                this.document = doc;
                doc.querySelector('script').textContent = '';
                this.domCommandApplier = new DomCommandApplier(doc);
                this.$.html.textContent = doc.documentElement.outerHTML;
              }).bind(this));
          }
        }
      });
    });
  })(window);

</script>
